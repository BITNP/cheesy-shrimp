<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒ«å¤´é¹°æ–‡æ³•</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet">
    <style>
        html, body {
            height: 100%; margin: 0; padding: 0; overflow: hidden;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f0f2f5; color: #333;
        }

        .app-container {
            display: grid;
            grid-template-rows: auto 1fr;
            grid-template-columns: 400px 1fr;
            height: 100vh; width: 100vw;
        }

        /* --- é¡¶éƒ¨é€šæ  --- */
        .top-bar {
            grid-column: 1 / -1; background: white; padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: center;
            justify-content: space-between; z-index: 10; border-bottom: 1px solid #e0e0e0;
        }
        .brand { font-size: 18px; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .input-group { flex: 1; display: flex; gap: 10px; justify-content: center; max-width: 900px; }
        input {
            padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px;
            width: 100%; max-width: 500px; font-size: 14px; font-family: 'Consolas', monospace;
        }
        
        /* æŒ‰é’®é€šç”¨æ ·å¼ */
        button {
            padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;
            font-size: 14px; background: #4CAF50; color: white; transition: background 0.2s; white-space: nowrap;
        }
        button:hover { background: #45a049; }
        button.secondary { background: #2196F3; }
        button.secondary:hover { background: #1976D2; }
        button.mode-btn { background: #607D8B; min-width: 140px; }
        button.mode-btn.active-right { background: #FF9800; }

        /* --- ä¾§è¾¹æ  --- */
        .sidebar {
            background: #fafafa; border-right: 1px solid #ddd; padding: 15px;
            overflow-y: auto; display: flex; flex-direction: column; gap: 15px;
        }
        .card {
            background: white; padding: 12px; border-radius: 6px;
            border: 1px solid #eee; box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        h3 {
            margin: 0 0 10px 0; font-size: 15px; color: #444; border-bottom: 2px solid #f0f0f0; padding-bottom: 5px;
        }

        /* æ–‡æ³•è§„åˆ™ */
        .grammar-rules p {
            margin: 5px 0; font-size: 13px; color: #333;
            font-family: 'Consolas', monospace; background: #f9f9f9; padding: 2px 5px; border-radius: 3px;
        }
        .rule-desc { font-size: 12px; color: #666; margin-top: 4px; }
        
        /* è¯­ä¹‰ç»“æœå¡ç‰‡ */
        .semantic-result { display: flex; gap: 8px; margin-bottom: 10px; }
        .body-part {
            flex: 1; text-align: center; padding: 8px 4px; border-radius: 4px; border: 1px solid;
        }
        .head { background: #e3f2fd; border-color: #90caf9; }
        .body { background: #f3e5f5; border-color: #ce93d8; }
        .part-label { font-size: 11px; color: #555; margin-bottom: 2px; }
        .part-value { font-size: 16px; font-weight: bold; color: #d32f2f; margin: 2px 0; }
        .part-source { font-size: 12px; color: #333; font-family: 'Consolas', monospace; background: rgba(255,255,255,0.5); border-radius: 3px; padding: 2px;}

        /* æ¨å¯¼åˆ—è¡¨ */
        #derivationList {
            font-size: 12px; padding-left: 25px; margin: 0; color: #555; font-family: 'Consolas', monospace;
        }
        #derivationList li { margin-bottom: 4px; }

        /* çŠ¶æ€æ¶ˆæ¯ */
        .error { color: #d32f2f; background: #ffebee; padding: 8px; border-radius: 4px; font-size: 12px; border: 1px solid #ffcdd2; }
        .success { color: #2e7d32; background: #e8f5e8; padding: 8px; border-radius: 4px; font-size: 12px; border: 1px solid #c8e6c9; }

        /* --- å¯è§†åŒ–åŒºåŸŸ --- */
        .main-panel { position: relative; background: white; overflow: hidden; }
        #syntaxTree { width: 100%; height: 100%; border: none; }
        .vis-label {
            background: rgba(255,255,255,0.9); padding: 5px 10px; border-radius: 4px;
            font-size: 12px; position: absolute; top: 10px; right: 10px; z-index: 5;
            pointer-events: none; border: 1px solid #ddd; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* --- æµ®çª—æ ·å¼ --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); z-index: 1000;
            display: none; /* é»˜è®¤éšè— */
            justify-content: center; align-items: center;
            backdrop-filter: blur(2px);
        }
        .modal-content {
            background: white; width: 900px; max-width: 90%; max-height: 85vh;
            border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: flex; flex-direction: column;
        }
        .modal-header {
            padding: 15px 20px; border-bottom: 1px solid #eee; background: #fafafa;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 8px 8px 0 0;
        }
        .modal-header h3 { margin: 0; border: none; padding: 0; font-size: 18px; }
        .close-btn {
            background: transparent; color: #888; font-size: 24px; padding: 0 10px;
            border: none; cursor: pointer; line-height: 1;
        }
        .close-btn:hover { background: transparent; color: #333; }
        
        .modal-body {
            padding: 20px; overflow-y: auto;
        }
        
        /* æµ®çª—å†…çš„ç½‘æ ¼å¸ƒå±€ */
        .modal-grid-section { margin-bottom: 20px; }
        .modal-cat-title {
            font-weight: bold; font-size: 14px; margin-bottom: 8px; color: #1976D2;
            border-left: 4px solid #1976D2; padding-left: 8px;
        }
        .modal-buttons {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px;
        }
        .ex-btn {
            font-size: 12px; padding: 8px; background: #f5f5f5; border: 1px solid #ddd;
            text-align: left; border-radius: 4px; color: #333;
            font-family: 'Consolas', monospace; word-break: break-all;
            white-space: normal; transition: all 0.2s;
        }
        .ex-btn:hover {
            background: #e3f2fd; border-color: #2196F3; color: #1976D2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* ğŸ“± ç§»åŠ¨ç«¯é€‚é… (å“åº”å¼å¸ƒå±€è¡¥ä¸) */
        @media screen and (max-width: 768px) {
            .app-container {
                grid-template-columns: 100%;
                grid-template-rows: auto 45vh 1fr;
                height: 100vh;
            }

            .top-bar {
                flex-direction: column;
                padding: 10px;
                gap: 10px;
                height: auto;
            }
            .brand { width: 100%; justify-content: center; margin-bottom: 5px; }
            .input-group {
                width: 100%;
                flex-wrap: wrap; /* æŒ‰é’®è‡ªåŠ¨æ¢è¡Œ */
            }
            input { max-width: 100%; width: 100%; }
            button { flex: 1; text-align: center; } /* æŒ‰é’®ç­‰å®½æ‹‰ä¼¸ï¼Œä¾¿äºç‚¹å‡» */

            .sidebar {
                grid-row: 3;
                border-right: none;
                border-top: 2px solid #ddd;
                padding: 10px;
            }

            .main-panel {
                grid-row: 2;
                background: #fff;
            }

            .modal-content {
                width: 95%;
                max-height: 90vh;
            }
            .modal-buttons {
                grid-template-columns: 1fr; /* ç¤ºä¾‹æŒ‰é’®æ¯è¡Œä¸€ä¸ª */
            }
            .ex-btn { padding: 10px; font-size: 14px; } /* å¢å¤§æŒ‰é’®ç‚¹å‡»åŒºåŸŸ */
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- é¡¶éƒ¨æ  -->
        <div class="top-bar">
            <div class="brand">ğŸ¦‰ çŒ«å¤´é¹°æ–‡æ³•</div>
            <div class="input-group">
                <input type="text" id="inputText" placeholder="è¾“å…¥å¦‚ï¼š(çŒ«å¤´é¹° å¤´ çŒ«) å¤´ é¹°" value="(çŒ«å¤´é¹° å¤´ çŒ«) å¤´ é¹°">
                <button id="assocBtn" onclick="toggleAssociativity()" class="mode-btn">æ¨¡å¼: å·¦ç»“åˆ</button>
                <button onclick="parseInput()">è§£æ (Parse)</button>
                <!-- è§¦å‘æµ®çª—çš„æŒ‰é’® -->
                <button onclick="openModal()" class="secondary">ğŸ“š æ‰“å¼€ç¤ºä¾‹åº“</button>
            </div>
        </div>

        <!-- å·¦ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="card grammar-rules">
                <h3>ğŸ“œ è§„åˆ™å®šä¹‰ (BNF)</h3>
                <div id="grammarContent"></div>
                <div class="rule-desc">
                    è¯­ä¹‰: å¤´=å·¦.å¤´, èº«=å³.èº«<br>
                    ä¼˜å…ˆçº§: ( ) > å¤´
                </div>
            </div>

            <div id="statusMessage"></div>

            <div class="card" id="semanticResult" style="display: none;">
                <h3>ğŸ§¬ è¯­ä¹‰åˆ†æç»“æœ</h3>
                <div class="semantic-result">
                    <div class="body-part head">
                        <div class="part-label">æœ€ç»ˆå¤´éƒ¨</div>
                        <div class="part-value" id="headValue">-</div>
                        <div class="part-source">æºè‡ª: <span id="headSource">-</span></div>
                    </div>
                    <div class="body-part body">
                        <div class="part-label">æœ€ç»ˆèº«ä½“</div>
                        <div class="part-value" id="bodyValue">-</div>
                        <div class="part-source">æºè‡ª: <span id="bodySource">-</span></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“ æ¨å¯¼è¿‡ç¨‹ (Derivation)</h3>
                <ol id="derivationList"></ol>
            </div>
        </div>

        <!-- å³ä¾§å¯è§†åŒ– -->
        <div class="main-panel">
            <div class="vis-label">
                ğŸ’¡ ç»¿è‰²: ç»ˆç»“ç¬¦ | é»„è‰²: è¡¨è¾¾å¼ | çº¢è‰²: é”™è¯¯
            </div>
            <div id="syntaxTree"></div>
        </div>
    </div>

    <!-- æµ®çª—ç»“æ„ -->
    <div id="examplesModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“š å¤æ‚æµ‹è¯•ç”¨ä¾‹åº“</h3>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody">
            </div>
        </div>
    </div>

    <script>
        // --- å…¨å±€é…ç½® ---
        let isRightAssociative = false;
        let nextNodeId = 1;

        // --- èŠ‚ç‚¹ç±» ---
        class ASTNode {
            constructor(type, label, value) {
                this.id = nextNodeId++;
                this.type = type; 
                this.label = label;
                this.value = value;
                this.children = [];
                this.fullText = ""; 
                this.semantics = { head: "", body: "", headSrc: "", bodySrc: "" };
            }
        }

        // --- 1. UI æ¸²æŸ“é€»è¾‘ ---
        function renderGrammar() {
            const container = document.getElementById('grammarContent');
            let html = '';
            if (isRightAssociative) {
                html += `<p><strong>E â†’ F H E | F</strong> (å³ç»“åˆ)</p>`;
            } else {
                html += `<p><strong>E â†’ E H F | F</strong> (å·¦ç»“åˆ)</p>`;
            }
            html += `<p><strong>F â†’ ( E ) | B</strong></p>`;
            html += `<p><strong>B â†’ "çŒ«" | "é¹°" | "çŒ«å¤´é¹°"</strong></p>`;
            html += `<p><strong>H â†’ "å¤´"</strong></p>`;
            container.innerHTML = html;
        }

        // --- 2. è¯æ³•åˆ†æ (Lexer) ---
        function tokenize(input) {
            const tokens = [];
            let i = 0;
            while(i < input.length) {
                if (/\s/.test(input[i])) { i++; continue; }
                if (input.startsWith("çŒ«å¤´é¹°", i)) {
                    tokens.push({ type: 'B', value: 'çŒ«å¤´é¹°', index: i }); i += 3; continue;
                }
                const char = input[i];
                if (['çŒ«','é¹°'].includes(char)) tokens.push({ type: 'B', value: char, index: i });
                else if (char === 'å¤´') tokens.push({ type: 'H', value: 'å¤´', index: i });
                else if (['(','ï¼ˆ'].includes(char)) tokens.push({ type: 'LPAREN', value: '(', index: i });
                else if ([')','ï¼‰'].includes(char)) tokens.push({ type: 'RPAREN', value: ')', index: i });
                else tokens.push({ type: 'UNKNOWN', value: char, index: i });
                i++;
            }
            tokens.push({ type: 'EOF', value: 'EOF', index: i });
            return tokens;
        }

        // --- 3. è¯­æ³•åˆ†æ (Parser) ---
        class Parser {
            constructor(tokens) {
                this.tokens = tokens;
                this.pos = 0;
                this.nodes = [];
                this.derivations = [];
            }
            peek() { return this.tokens[this.pos]; }
            consume(type) {
                const token = this.peek();
                if (token.type === type) { this.pos++; return token; }
                
                let msg = `è¯­æ³•é”™è¯¯: æœŸå¾… ${type}, å®é™…æ˜¯ ${token.value}`;
                if (token.type === 'UNKNOWN') msg = `è¯æ³•é”™è¯¯: éæ³•å­—ç¬¦ '${token.value}'`;
                if (token.type === 'EOF') msg = `è¯­æ³•é”™è¯¯: è¯­å¥æœªå®Œæˆï¼ŒæœŸå¾… ${type}`;
                throw { token: token, msg: msg };
            }
            register(node) { this.nodes.push(node); return node; }
            logRule(rule) { this.derivations.push(rule); }

            // F -> ( E ) | B
            parseFactor() {
                const token = this.peek();
                if (token.type === 'B') {
                    this.consume('B');
                    const node = this.register(new ASTNode('B', 'Factor', token.value));
                    node.fullText = token.value; 
                    this.logRule(`F â†’ B (${token.value})`);
                    return node;
                } else if (token.type === 'LPAREN') {
                    this.consume('LPAREN');
                    const lNode = this.register(new ASTNode('SYM', '(', '('));
                    const expr = this.parseExpression();
                    this.consume('RPAREN');
                    const rNode = this.register(new ASTNode('SYM', ')', ')'));

                    const fNode = this.register(new ASTNode('F', 'Factor', '()'));
                    fNode.children = [lNode, expr, rNode];
                    fNode.fullText = `(${expr.fullText})`; 
                    this.logRule(`F â†’ ( E )`);
                    return fNode;
                } else {
                    this.consume('B'); // Trigger error
                }
            }

            parseExpression() {
                return isRightAssociative ? this.parseRightE() : this.parseLeftE();
            }

            // å·¦ç»“åˆ: E -> E H F
            parseLeftE() {
                let left = this.parseFactor();
                this.logRule(`E â†’ F`);

                while (this.peek().type === 'H') {
                    this.consume('H');
                    const hNode = this.register(new ASTNode('H', 'å¤´', 'å¤´'));
                    hNode.fullText = " å¤´ "; 
                    const right = this.parseFactor();

                    const newE = this.register(new ASTNode('E', 'Expr', 'E'));
                    newE.children = [left, hNode, right];
                    newE.fullText = left.fullText + " å¤´ " + right.fullText;
                    
                    this.logRule(`E â†’ E H F`);
                    left = newE;
                }
                return left;
            }

            // å³ç»“åˆ: E -> F H E
            parseRightE() {
                let left = this.parseFactor();
                if (this.peek().type === 'H') {
                    this.consume('H');
                    const hNode = this.register(new ASTNode('H', 'å¤´', 'å¤´'));
                    hNode.fullText = " å¤´ ";
                    const right = this.parseRightE();

                    const newE = this.register(new ASTNode('E', 'Expr', 'E'));
                    newE.children = [left, hNode, right];
                    newE.fullText = left.fullText + " å¤´ " + right.fullText;

                    this.logRule(`E â†’ F H E`);
                    return newE;
                }
                this.logRule(`E â†’ F`);
                return left;
            }

            parse() {
                const root = this.parseExpression();
                if (this.peek().type !== 'EOF') throw { token: this.peek(), msg: `æœ‰å¤šä½™å†…å®¹: ${this.peek().value}` };
                return root;
            }
        }

        // --- 4. è¯­ä¹‰è®¡ç®— ---
        function calcSemantics(node) {
            if (!node) return;
            
            if (node.type === 'B') {
                node.semantics = { 
                    head: node.value, body: node.value, 
                    headSrc: node.fullText, bodySrc: node.fullText
                };
                return;
            }
            if (node.type === 'F') {
                const inner = node.children[1]; 
                calcSemantics(inner);
                node.semantics = { ...inner.semantics };
                return;
            }
            if (node.type === 'E') {
                const left = node.children[0];
                const right = node.children[2];
                calcSemantics(left);
                calcSemantics(right);
                
                node.semantics = {
                    head: left.semantics.head,
                    body: right.semantics.body,
                    headSrc: left.fullText,   
                    bodySrc: right.fullText   
                };
            }
        }

        // --- 5. ä¸»é€»è¾‘ ---
        function toggleAssociativity() {
            isRightAssociative = !isRightAssociative;
            const btn = document.getElementById('assocBtn');
            if (isRightAssociative) {
                btn.textContent = "æ¨¡å¼: å³ç»“åˆ";
                btn.classList.add('active-right');
            } else {
                btn.textContent = "æ¨¡å¼: å·¦ç»“åˆ";
                btn.classList.remove('active-right');
            }
            renderGrammar();
            parseInput();
        }

        function parseInput() {
            nextNodeId = 1;
            const text = document.getElementById('inputText').value.trim();
            const msgDiv = document.getElementById('statusMessage');
            const derivList = document.getElementById('derivationList');
            const semRes = document.getElementById('semanticResult');

            msgDiv.innerHTML = '';
            derivList.innerHTML = '';
            semRes.style.display = 'none';

            if(!text) { visualizeTree([]); return; }

            let parser = null;
            try {
                const tokens = tokenize(text);
                parser = new Parser(tokens);
                const root = parser.parse();

                calcSemantics(root);

                msgDiv.innerHTML = `<div class="success">âœ… è§£ææˆåŠŸ</div>`;
                
                document.getElementById('headValue').textContent = root.semantics.head;
                document.getElementById('bodyValue').textContent = root.semantics.body;
                document.getElementById('headSource').textContent = root.semantics.headSrc;
                document.getElementById('bodySource').textContent = root.semantics.bodySrc;
                semRes.style.display = 'block';

                derivList.innerHTML = parser.derivations.map(r => `<li>${r}</li>`).join('');

                visualizeTree(parser.nodes);

            } catch (e) {
                console.error(e);
                const errMsg = e.msg || "æœªçŸ¥é”™è¯¯";
                msgDiv.innerHTML = `<div class="error">âŒ ${errMsg}</div>`;

                const nodes = parser ? parser.nodes : [];
                if (e.token) {
                    nodes.push({
                        id: nextNodeId++,
                        type: 'ERROR',
                        label: errMsg, 
                        value: errMsg
                    });
                    if(parser) {
                        for(let i = parser.pos + 1; i < parser.tokens.length; i++) {
                            const t = parser.tokens[i];
                            if(t.type === 'EOF') continue;
                            nodes.push({
                                id: nextNodeId++, type: 'SKIPPED', label: t.value
                            });
                        }
                    }
                }
                visualizeTree(nodes);
            }
        }

        // --- 6. å¯è§†åŒ– ---
        function visualizeTree(nodes) {
            const container = document.getElementById('syntaxTree');
            const visNodes = new vis.DataSet();
            const visEdges = new vis.DataSet();
            const existingIds = new Set(nodes.map(n => n.id));

            nodes.forEach(node => {
                let color = '#E3F2FD';
                let label = node.fullText || node.value; 
                let shape = 'box';
                let font = { multi: true, size: 14, color: '#333' };
                let borderDashes = false;

                switch(node.type) {
                    case 'B': 
                        color = '#C8E6C9';
                        shape = 'ellipse';
                        break;
                    case 'H': 
                        color = '#F5F5F5';
                        label = 'å¤´';
                        font.color = '#888';
                        font.size = 12;
                        shape = 'circle';
                        break;
                    case 'E': 
                        color = '#FFF9C4';
                        let displayTxt = node.fullText;
                        if(displayTxt.length > 15) displayTxt = displayTxt.substring(0,12) + "...";
                        
                        if (node.semantics && node.semantics.head) {
                            label = `${displayTxt}\n[å¤´:${node.semantics.head} | èº«:${node.semantics.body}]`;
                        } else {
                            label = displayTxt;
                        }
                        break;
                    case 'F':
                        color = '#E1BEE7';
                        label = node.fullText; 
                        if(label.length > 15) label = label.substring(0,12) + "...";
                        break;
                    case 'SYM':
                        color = '#ffffff';
                        shape = 'text';
                        font.size = 18;
                        label = node.value;
                        break;
                    case 'ERROR': 
                        color = '#FFCDD2';
                        font.color = '#D32F2F';
                        shape = 'box';
                        label = node.label.replace(/(.{20})/g, "$1\n"); 
                        break;
                    case 'SKIPPED':
                        color = '#f5f5f5';
                        font.color = '#aaa';
                        borderDashes = true;
                        label = node.label;
                        break;
                }

                visNodes.add({
                    id: node.id,
                    label: label,
                    shape: shape,
                    color: { background: color, border: '#999' },
                    font: font,
                    shapeProperties: { borderDashes: borderDashes },
                    title: node.fullText || node.value,
                    shadow: true
                });

                if (node.children) {
                    node.children.forEach(child => {
                        if (existingIds.has(child.id)) {
                            visEdges.add({ from: node.id, to: child.id, arrows: 'to', color: {color:'#ccc'} });
                        }
                    });
                }
            });

            const data = { nodes: visNodes, edges: visEdges };
            const options = {
                layout: {
                    hierarchical: {
                        direction: 'UD',
                        sortMethod: 'directed',
                        levelSeparation: 80,
                        nodeSpacing: 160
                    }
                },
                physics: false,
                interaction: { dragNodes: true, zoomView: true }
            };
            new vis.Network(container, data, options);
        }

        // --- 7. æµ®çª—åŠŸèƒ½ä¸å¤§é‡ç¤ºä¾‹ ---
        function openModal() {
            populateExamples();
            document.getElementById('examplesModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('examplesModal').style.display = 'none';
        }

        function loadExample(str) {
            document.getElementById('inputText').value = str;
            parseInput();
            closeModal();
        }

        function populateExamples() {
            const container = document.getElementById('modalBody');
            if (container.innerHTML.trim() !== "") return; // åªåˆå§‹åŒ–ä¸€æ¬¡

            const categories = {
                'ğŸŸ¢ åŸºç¡€å…¥é—¨ (Basic)': [
                    'çŒ«', 'é¹°', 'çŒ«å¤´é¹°',
                    'çŒ« å¤´ é¹°', 'çŒ« å¤´çŒ«', 'é¹° å¤´ é¹°'
                ],
                'ğŸŸ¡ è´ªå©ªåŒ¹é…ä¸ç©ºæ ¼ (Lexer)': [
                    'çŒ«å¤´é¹°', 'çŒ« å¤´ é¹°', 
                    'çŒ«å¤´é¹°å¤´çŒ«', 'çŒ«å¤´é¹° å¤´ çŒ«',
                    'çŒ« å¤´ é¹° å¤´ çŒ«', 'çŒ«å¤´é¹° å¤´ çŒ«å¤´é¹°'
                ],
                'ğŸ”µ æ‹¬å·ä¼˜å…ˆçº§ (Precedence)': [
                    '(çŒ« å¤´ é¹°)', '((çŒ«))',
                    '(çŒ« å¤´ é¹°) å¤´ çŒ«', 
                    'çŒ« å¤´ (é¹° å¤´ çŒ«)',
                    '((çŒ« å¤´ é¹°) å¤´ çŒ«) å¤´ é¹°',
                    'çŒ« å¤´ (é¹° å¤´ (çŒ« å¤´ é¹°))'
                ],
                'ğŸŸ£ æ·±åº¦åµŒå¥— (Deep Nesting)': [
                    'çŒ« å¤´ é¹° å¤´ çŒ« å¤´ é¹° å¤´ çŒ«',
                    '((((çŒ«) å¤´ é¹°) å¤´ çŒ«) å¤´ é¹°)',
                    'çŒ«å¤´ (é¹°å¤´ (çŒ«å¤´ (é¹°å¤´ çŒ«)))',
                    '(çŒ«å¤´é¹° å¤´ çŒ«) å¤´ (é¹° å¤´ çŒ«å¤´é¹°)'
                ],
                'ğŸ”„ é€’å½’ä¸å¾ªç¯ (Recursion)': [
                    'çŒ«å¤´çŒ«å¤´çŒ«å¤´çŒ«',
                    'é¹°å¤´é¹°å¤´é¹°å¤´é¹°å¤´é¹°',
                    'çŒ«å¤´é¹°å¤´çŒ«å¤´é¹°å¤´çŒ«å¤´é¹°',
                    'çŒ«å¤´é¹° å¤´ çŒ«å¤´é¹° å¤´ çŒ«å¤´é¹°'
                ],
                'ğŸ”´ é”™è¯¯æµ‹è¯• (Errors)': [
                    'çŒ«å¤´', 'å¤´çŒ«', 
                    'çŒ«å¤´@é¹°', 'çŒ«å¤´ 123',
                    '((çŒ«å¤´é¹°', 'çŒ«å¤´é¹°))',
                    'çŒ« å¤´ å¤´ é¹°'
                ],
                'ğŸ§ª ç»¼åˆæµ‹è¯• (Complex)': [
                    '(çŒ«å¤´é¹° å¤´ çŒ«) å¤´ (é¹° å¤´ (çŒ« å¤´ é¹°))',
                    'çŒ«å¤´é¹° å¤´ çŒ« å¤´ (é¹° å¤´ çŒ«å¤´é¹°)',
                    '((çŒ« å¤´ é¹°) å¤´ çŒ«) å¤´ (é¹° å¤´ (çŒ« å¤´ é¹°))',
                    'çŒ« å¤´ (é¹° å¤´ (çŒ« å¤´ (é¹° å¤´ çŒ«)))'
                ]
            };

            let html = '';
            for (const [cat, examples] of Object.entries(categories)) {
                html += `<div class="modal-grid-section">`;
                html += `<div class="modal-cat-title">${cat}</div>`;
                html += `<div class="modal-buttons">`;
                html += examples.map(ex => 
                    `<button class="ex-btn" onclick="loadExample('${ex}')">${ex}</button>`
                ).join('');
                html += `</div></div>`;
            }
            container.innerHTML = html;
        }

        // ç‚¹å‡»é®ç½©å…³é—­
        document.getElementById('examplesModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        window.onload = function() {
            renderGrammar();
            parseInput();
        };
    </script>
</body>
</html>
